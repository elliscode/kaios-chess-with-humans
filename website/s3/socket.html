<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Chess with Humans</title>
  <meta name="description" content="This is the home of Chess with Humans.">
  <meta name="author" content="Daniel Ellis Townsend">
  <meta name="viewport" content="width=device-width">
  <style>
  </style>
</head>

<body>
  <h1>Web socket testing</h1>
  <button onclick="startConnection(event);">Start websocket</button>
  <input type="text" id="text-box"/><button onclick="sendMessage(event);">Send Message</button>
  <script>
let socket = undefined;
const textBox = document.getElementById('text-box');
const messagesOnDeck = [];
function startConnection(event) {
  // Create a new WebSocket connection
  socket = new WebSocket('wss://59ms2wie22.execute-api.us-east-1.amazonaws.com/dev/');

  // When the connection is established
  socket.addEventListener('open', (event) => {
    console.log('Connected to WebSocket server.');
    // register the websocket with the game id and the password
    socket.send(JSON.stringify({ action: 'register', message: {"game_id": "", "password": ""}}));
    // Optionally send a message
    while (messagesOnDeck.length > 0) {
      socket.send(messagesOnDeck.pop(0));
    }
  });

  // When a message is received
  socket.addEventListener('message', (event) => {
    console.log('Message from server:', event.data);
  });

  // When the connection closes
  socket.addEventListener('close', (event) => {
    console.log('Connection closed:', event.code, event.reason);
  });

  // When an error occurs
  socket.addEventListener('error', (error) => {
    console.error('WebSocket error:', error);
  });
}
function sendMessage(event) {
  const content = JSON.stringify({ action: '$default', message: textBox.value });
  if (!socket || socket.readyState != WebSocket.OPEN) {
    startConnection(event);
    messagesOnDeck.push(content);
  } else {
    socket.send(content);
  }
}
  </script>

</body>

</html>